<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì¹´í…Œê³ ë¦¬</title>
  <link rel="stylesheet" href="../css/categorystyle.css" />
</head>
<body>
  <nav>
    <ul>
      <li><a href="../index.html">Home</a></li>
      <li><a href="category.html">Category</a></li>
      <li><a href="summary.html">summary</a></li>
      <li><a href="background.html">background</a></li>
      <li><a href="board.html">board</a></li>
    </ul>
  </nav>

  <header>
    <h1>ì´ë‹¬ì˜ ì¶”ì²œ ì±…</h1>
    <button id="toggle-form">ğŸ“š ì±… ë“±ë¡í•˜ê¸°</button>
  </header>

  <section id="category-buttons">
    <button class="cat-btn active" data-cat="all">ì „ì²´ë³´ê¸°</button>
    <button class="cat-btn" data-cat="ë¬¸í•™">ë¬¸í•™</button>
    <button class="cat-btn" data-cat="ê³¼í•™">ê³¼í•™</button>
    <button class="cat-btn" data-cat="ìê¸°ê³„ë°œ">ìê¸°ê³„ë°œ</button>
    <button class="cat-btn" data-cat="ì˜ˆìˆ ">ì˜ˆìˆ </button>
    <button class="cat-btn" data-cat="ê¸°íƒ€">ê¸°íƒ€</button>
  </section>

  <section id="form-section" style="display: none;">
    <form id="book-form">
      <select id="category" required>
        <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
        <option value="ë¬¸í•™">ë¬¸í•™</option>
        <option value="ê³¼í•™">ê³¼í•™</option>
        <option value="ìê¸°ê³„ë°œ">ìê¸°ê³„ë°œ</option>
        <option value="ì˜ˆìˆ ">ì˜ˆìˆ </option>
        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
      </select>
      <input type="text" id="title" placeholder="ì±… ì œëª©" required />
      <input type="text" id="author" placeholder="ì‘ê°€" required />
      <input type="text" id="publisher" placeholder="ì¶œíŒì‚¬" required />
      <input type="text" id="buyLink" placeholder="êµ¬ë§¤ ë§í¬ (ì„ íƒ)" />
      <input type="file" id="cover" accept="image/*" />
      <button type="submit">ì±… ë“±ë¡</button>
    </form>
  </section>

  <section id="book-list"></section>

<script>
  const toggleBtn = document.getElementById('toggle-form');
  const formSection = document.getElementById('form-section');
  const bookForm = document.getElementById('book-form');
  const bookList = document.getElementById('book-list');
  const categoryButtons = document.querySelectorAll('.cat-btn');

  let books = JSON.parse(localStorage.getItem('books')) || [];
  let currentFilter = 'all';

  // í† ê¸€ í¼ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
  toggleBtn.onclick = () => {
    formSection.style.display = formSection.style.display === 'none' ? 'block' : 'none';
  };

  // ì €ì¥ í›„ ë Œë”ë§ & ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
  function saveBooks() {
    localStorage.setItem('books', JSON.stringify(books));
  }

  // ì±… ì‚­ì œ
  function deleteBook(index) {
    if(confirm('ì •ë§ ì´ ì±…ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      books.splice(index, 1);
      saveBooks();
      renderBooks(currentFilter);
    }
  }

  // ì±… ë Œë”ë§
  function renderBooks(filter) {
    bookList.innerHTML = '';
    // í•„í„°ë§
    const filteredBooks = filter === 'all' ? books : books.filter(b => b.category === filter);

    if (filteredBooks.length === 0) {
      bookList.innerHTML = '<p>ë“±ë¡ëœ ì±…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
      return;
    }

    filteredBooks.forEach((book, idx) => {
      // ì‹¤ì œ ì¸ë±ìŠ¤ ì°¾ê¸° (ì „ì²´ ë°°ì—´ ê¸°ì¤€)
      const realIndex = books.indexOf(book);

      const card = document.createElement('div');
      card.className = 'book-card';
      card.innerHTML = `
        ${book.imageUrl ? `<img src="${book.imageUrl}" alt="ì±…í‘œì§€">` : ''}
        <div class="info">
          <h3>${book.title}</h3>
          <p>ğŸ‘¤ ${book.author}</p>
          <p>ğŸ¢ ${book.publisher}</p>
          ${book.buyLink ? `<p><a href="${book.buyLink}" target="_blank" rel="noopener noreferrer">ğŸ“– êµ¬ë§¤í•˜ê¸°</a></p>` : ''}
          <button class="delete-btn" data-index="${realIndex}">ì‚­ì œ</button>
        </div>
      `;
      bookList.appendChild(card);
    });

    // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.onclick = () => {
        const idx = parseInt(btn.getAttribute('data-index'));
        deleteBook(idx);
      };
    });
  }

  // ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì´ë²¤íŠ¸
  categoryButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      categoryButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentFilter = btn.getAttribute('data-cat');
      renderBooks(currentFilter);
    });
  });

  // í¼ ì œì¶œ
  bookForm.onsubmit = (e) => {
    e.preventDefault();

    const category = document.getElementById('category').value;
    const title = document.getElementById('title').value;
    const author = document.getElementById('author').value;
    const publisher = document.getElementById('publisher').value;

    // buyLink ìë™ http/https ë¶™ì´ê¸° ì²˜ë¦¬
    let buyLink = document.getElementById('buyLink').value.trim();
    if (buyLink && !buyLink.startsWith('http://') && !buyLink.startsWith('https://')) {
      buyLink = 'http://' + buyLink;
    }

    const coverInput = document.getElementById('cover');

    const reader = new FileReader();
    reader.onload = function () {
      const imageUrl = reader.result;

      books.push({ category, title, author, publisher, buyLink, imageUrl });
      saveBooks();
      renderBooks(currentFilter);
      bookForm.reset();
      formSection.style.display = 'none';
    };

    if (coverInput.files[0]) {
      reader.readAsDataURL(coverInput.files[0]);
    } else {
      books.push({ category, title, author, publisher, buyLink, imageUrl: '' });
      saveBooks();
      renderBooks(currentFilter);
      bookForm.reset();
      formSection.style.display = 'none';
    }
  };

  // ì´ˆê¸° ë Œë”ë§
  renderBooks(currentFilter);
</script>
</body>
</html>
